+++
date = "2015-04-23T14:41:21+09:00"
draft = true
title = "PaaSはどう動いているのか"
+++

PaaSがどのように動いているのか内部の仕組みを知りたいと聞かれたので簡単に書いてみる．

## ユーザ視点のPaaS

まず利用者からみたPaaSの動作について．だいたい以下のような感じになる．

- アプリケーションを準備する（cf. [The Twelve-Factor App](http://12factor.net/)）
- アカウントを作成してPaaS内にアプリケーションを作成する．PaaSごとに専用のCLIが提供されている（e.g., `heroku create`）
- デプロイする．PaaSによって異なる．HerokuやFlynnの場合は`git push`を使うしCFの場合は`cf push`という専用コマンドを使う．デプロイすると依存パッケージがインストールされて終わり次第アプリケーションが起動する．起動すると[http://polar-inlet-4930.herokuapp.com/](http://polar-inlet-4930.herokuapp.com/)のようなURLが自動で付与され，アプリケーションにアクセスできるようになる
- スケールする（e.g., `flynn scale web=3`）
- DBや外部サービス（e.g., [papertrail](https://papertrailapp.com/)）を利用する（e.g., `heroku addons:add`）

IaaSの場合はOSを準備して各種ミドルウェアをインストールしてデプロイスクリプトを準備してモニタリングを準備して...といったことが必要になるが，PaaSの場合はそのような手間を省くことができる．

## PaaSはどう動いているのか

では上記のことを実現するためにPaaS内部では何が行われているのかを説明する．質問形式でざっと書いていく．

### どのようなコンポーネントがあるのか?

PaaSは大まかには以下のようなコンポーネントから構成される．

- **コントローラー** - PaaSの脳．HTTP APIでありCLIからのリクエストを受けて他のコンポーネントを操作する．Herokuでいうと[Platform API](https://devcenter.heroku.com/articles/platform-api-reference)．
- **ルーター** - PaaSのフロントには専用のルータが存在して各種リクエストを振り分ける．
- **実行環境（コンテナ）** - アプリケーションの実行環境．PaaS上では様々な言語による様々なアプリケーションが動く．そのためリソースを隔離する必要がある．PaaSはこれにコンテナを使っている．Herokuの場合はLXCを改造したもの(?)，CFの場合はWarden，Flynnの場合はDockerを使っている
- **DB等のサービス** - DB等はサービスとして提供されておりアプリケーションごとにそれにバインドする．

### リクエストはどのようにアプリケーションに到達するのか?

### デプロイ時には何が起こっているのか?

### スケール時には何が起こっているのか?



